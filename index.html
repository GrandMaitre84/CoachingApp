<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  

  <!-- CSS externe + cache-buster -->
  <link rel="stylesheet" href="./style.css?v=7" />

  <!-- CSS critique inline (sécurité : onglets) -->
  <style>
    .tab { display: none; }
    .tab.active { display: block; }
    .hidden { display: none; }
  </style>

  <!-- Manifest + meta -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#4da6ff">

  <!-- Icônes -->
  <link rel="icon" href="./icons/icon-192.png">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- Script principal + cache-buster -->
  <script src="./script.js?v=7" defer></script>
</head>

<body>


  <main>
    <!-- Onglet 1 -->
    <section id="tab1" class="tab active">
      <div class="date-row">
        <span id="todayDisplay" class="date-pill">Date : --/--/----</span>
      </div>

      <div id="startPanel">
        <button id="startBtn" class="primary" onclick="startQA()">COMMENCER</button>
      </div>

      <div id="qaPanel" class="hidden">
        <div id="questionText"></div>
        <div id="inputSlot"></div>
        <div>
          <button id="submitAnswer" class="primary" onclick="submitAnswer()" style="display:none;">Valider</button>
        </div>
        <div id="progress"></div>
      </div>

      <div id="donePanel" class="hidden">
        <p>🔥 C’est tout pour aujourd’hui. Bien joué !</p>
      </div>
    </section>

    <!-- Onglet 2 : menu -->
    <section id="tab2" class="tab">
      <h2 id="tab2-title" class="section-title">💫 Mon suivi</h2>
      <div id="tab2-menu" class="dashboard-grid">
        <button class="tile"
          onclick="switchTab('tab2-sleep', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
          😴 SOMMEIL
        </button>
        <button class="tile"
          onclick="switchTab('tab2-weight', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
          ⚖️ POIDS
        </button>
        <button class="tile"
          onclick="switchTab('tab2-steps', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
          🦶 PAS
        </button>
        <button class="tile"
          onclick="switchTab('tab2-nutrition', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
          🍽️ NUTRITION
        </button>
      </div>
    </section>

    
    <!-- Sous-page : Graphique Sommeil -->
    <section id="tab2-sleep" class="tab">
      <button class="back"
        onclick="switchTab('tab2', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">← Retour</button>

      <div class="card">
        <div class="card-header">
          <h2>Sommeil (durée)</h2>
          <span id="lastSleepBadge" class="chip">—</span>
        </div>
        <div class="chart-wrap" style="height:260px">
          <canvas id="sleepChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Sous-page : Graphique Poids -->
    <section id="tab2-weight" class="tab">
      <button class="back"
        onclick="switchTab('tab2', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">← Retour</button>

      <div class="card">
        <div class="card-header">
          <h2>Évolution du poids</h2>
          <span id="lastWeightBadge" class="chip">—</span>
        </div>
        <div class="chart-wrap" style="height:260px">
          <canvas id="weightChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Sous-page : Graphique Pas -->
    <section id="tab2-steps" class="tab">
      <button class="back"
        onclick="switchTab('tab2', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">← Retour</button>

      <div class="card">
        <div class="card-header">
          <h2>Nombre de pas</h2>
          <span id="lastStepsBadge" class="chip">—</span>
        </div>
        <div class="chart-wrap" style="height:260px">
          <canvas id="stepsChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Sous-page : Nutrition -->
    <section id="tab2-nutrition" class="tab hidden">
      <button class="back"
        onclick="switchTab('tab2', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">← Retour</button>

      <div class="card">
        <div class="card-header">
          <h2>Programme nutrition</h2>
        </div>

        <!-- Contenu injecté en JS : table / cartes repas -->
        <div id="nutriContent" class="nutri-content">
          <p class="note">Chargement…</p>
        </div>
      </div>
    </section>


    <!-- Onglet 3 -->
    <section id="tab3" class="tab">
      <p class="note">Ping ton Apps Script puis regarde la réponse ci-dessous.</p>
      <button id="ping" class="primary" onclick="pingScript()">Tester la connexion</button>
      <pre id="pingResult"></pre>
    </section>

    <section>
      <p class="note">Diagnostic : <span id="diag" class="ok">JS chargé</span></p>
    </section>
  </main>

  <!-- Barre de navigation -->
  <nav class="bottom-nav">
    <button type="button" class="tab-btn active" data-tab="tab1" onclick="switchTab('tab1', this)">Accueil</button>
    <button type="button" class="tab-btn" data-tab="tab2" onclick="switchTab('tab2', this)">Suivi</button>
    <button type="button" class="tab-btn" data-tab="tab3" onclick="switchTab('tab3', this)">Paramètres</button>
  </nav>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('✅ Service Worker enregistré', reg))
        .catch(err => console.warn('❌ Service Worker erreur', err));
    }
  </script>

  <script>
  if ('serviceWorker' in navigator) {
    // ⚠️ Mettez à jour ce numéro à chaque release
    const SW_VERSION = 'v7';
    navigator.serviceWorker.register(`./sw.js?${SW_VERSION}`).then(reg => {
      setInterval(() => reg.update(), 60 * 60 * 1000);
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        location.reload();
      });
    });
  }
  </script>

  <!--
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
  -->

</body>
</html>
