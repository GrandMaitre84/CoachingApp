<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



  <!-- CSS externe + cache-buster -->
  <link rel="stylesheet" href="./style.css?v=12" />

  <!-- CSS critique inline (s√©curit√© : onglets) -->
  <style>
    .tab { display: none; }
    .tab.active { display: block; }
    .hidden { display: none; }
  </style>

  <!-- Manifest + meta -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#4da6ff">

  <!-- Ic√¥nes -->
  <link rel="icon" href="./icons/icon-192.png">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">


</head>

<body>

  <!-- üîê √âCRAN DE CONNEXION FULL PAGE -->
  <div id="loginPanel" class="hidden">
    <div class="login-card">
      <h2>Connexion</h2>
      <p class="note">Entre ton code client pour acc√©der √† ton espace :</p>

      <input
        id="loginInput"
        type="text"
        placeholder="..."
        autocomplete="off"
      />

      <button class="primary" onclick="submitClientLogin()">
        Continuer
      </button>
    </div>
  </div>


  <main>

  <!-- Onglet 1 -->
  <section id="tab1" class="tab active">

    <!-- üü¢ R√©sum√© d‚Äôhier -->
    
    <div id="yesterdaySummary" class="yesterday-card home-anim">


      <!-- üîπ Date du jour (discr√®te en haut √† gauche du bloc) -->
      <div class="yesterday-today-row">
        <span id="todayDisplay" class="yesterday-today-pill">--/--/----</span>
      </div>

      <!-- üîπ En-t√™te titre + date d‚Äôhier -->
      <div class="yesterday-header">
        <div class="yesterday-title-wrap">
          <span class="yesterday-icon">üìä</span>
          <div>
            <div class="yesterday-title">R√©sum√© d‚Äôhier</div>
            <div class="yesterday-subtitle">Un coup d‚Äô≈ìil sur ta derni√®re journ√©e</div>
          </div>
        </div>

        <!-- Date d‚Äôhier -->
        <span id="yesterdayDate" class="chip chip-soft">--/--/----</span>
      </div>

      <div class="yesterday-grid">



          
          <!-- Sommeil -->
          <div class="yesterday-item">
            <div class="yesterday-item-label">
              <span class="yesterday-emoji">üò¥</span>
              <span>Sommeil</span>
            </div>
            <div id="yesterdaySleep" class="yesterday-value">‚Äî</div>
          </div>

          <!-- Poids -->
          <div class="yesterday-item">
            <div class="yesterday-item-label">
              <span class="yesterday-emoji">‚öñÔ∏è</span>
              <span>Poids</span>
            </div>
            <div id="yesterdayWeight" class="yesterday-value">‚Äî</div>
          </div>

          <!-- Pas -->
          <div class="yesterday-item">
            <div class="yesterday-item-label">
              <span class="yesterday-emoji">üëü</span>
              <span>Pas</span>
            </div>
            <div id="yesterdaySteps" class="yesterday-value">‚Äî</div>
          </div>

          <!-- √ânergie -->
          <div class="yesterday-item">
            <div class="yesterday-item-label">
              <span class="yesterday-emoji">‚ö°</span>
              <span>√ânergie</span>
            </div>
            <div id="yesterdayEnergy" class="yesterday-value">‚Äî</div>
          </div>
        </div>
      </div>


      
      <!-- Nouveau bouton principal -->
     <div id="bilanPanel">
       <button id="bilanBtn" class="primary home-anim" onclick="openDailyCheckin()">BILAN DU JOUR</button>
       <button class="primary home-anim" onclick="openTrainingPage()" style="margin-top: 12px;">TRAINING</button>
       <button type="button" class="primary home-anim" onclick="goToNutrition()">NUTRITION</button>
     </div>




      <!-- Ancien bloc de d√©marrage (on le cache au d√©but) -->
      <div id="startPanel" class="hidden">
        <button id="backHomeBtn" class="secondary" onclick="backToHome()">‚Üê Retour</button>
        <button id="startBtn" class="primary" onclick="startQA()">COMMENCER</button>
      </div>


      <!-- üîô Bouton retour AU-DESSUS du bloc blanc -->
      <button
        id="goBackAnswer"
        class="secondary question-back"
        onclick="goBackQuestion()"
        style="display:none; margin:12px auto 14px; width:90%; max-width:360px;">
        ‚Üê Modifier la r√©ponse pr√©c√©dente
      </button>

      <!-- Panneau Q&A (questions quotidiennes) -->
      <div id="qaPanel" class="hidden card question-card">

        <div class="question-header">
          <div id="questionStep" class="question-step">Question 1 / 11</div>
          <div id="questionText" class="question-title">Texte de la question</div>
        </div>

        <div id="inputSlot" class="question-input"></div>

        <button
          id="submitAnswer"
          class="primary question-submit"
          onclick="submitAnswer()"
          style="display:none;">
          Valider
        </button>

        <div class="question-footer">
          <div class="question-progress-bar">
            <div id="questionProgressInner" class="question-progress-inner"></div>
          </div>
          <div id="progress" class="question-progress-text">
            Question 1 sur 11
          </div>
        </div>

      </div>


      <div id="donePanel" class="hidden done-card card">
        <div class="done-emoji">üî•</div>
        <h2 class="done-title">C‚Äôest tout pour aujourd‚Äôhui</h2>
        <p class="done-subtitle">Tu as compl√©t√© ton bilan du jour. Beau travail üëå</p>

        <div class="done-chip">Bilan du jour enregistr√©</div>

        <p class="done-next">Reviens demain pour continuer ta progression.</p>

        <button class="primary done-btn" onclick="goToTab(1)">
          ‚Üê Retour √† l‚Äôaccueil
        </button>
      </div>



      <!-- Panneau PROFIL (cach√© au d√©part) -->
      <div id="profilePanel" class="hidden">
        <button class="secondary" onclick="closeProfile()">‚Üê Retour</button>

        <div class="card profile-card">
          <h2 class="profile-title">Mon profil</h2>

          <div class="profile-name-row">
            <span id="profileNameBadge" class="chip">‚Äî</span>
          </div>

          <div class="profile-grid">
            <div class="profile-item">
              <div class="profile-label">√Çge</div>
              <div id="profileAge" class="profile-value">‚Äî</div>
            </div>

            <div class="profile-item">
              <div class="profile-label">D√©but du coaching</div>
              <div id="profileStartDate" class="profile-value">‚Äî</div>
            </div>

            <div class="profile-item">
              <div class="profile-label">Score sant√©</div>
              <div id="profileHealthScore" class="profile-value">‚Äî</div>
            </div>
            <!-- Panneau TO DO LIST (cach√© au d√©part) -->
            <div id="todoPanel" class="hidden">
              <button class="secondary" onclick="closeTodo()">‚Üê Retour</button>

              <div class="card">
                <h2 class="profile-title">To Do List</h2>
                <p class="note">
                  Espace TODO √† configurer (t√¢ches, cases √† cocher, etc.).
                </p>
              </div>
            </div>


            <!-- ‚ö†Ô∏è Bloc Points sant√© RESTE dans la grille -->
            <div class="profile-item">
              <div class="profile-label">Points sant√©</div>
              <div id="profileHealthPoints" class="profile-value">‚Äî / 100</div>
            </div>
          </div>


          <!-- ‚úÖ Barre de points sant√© sous les blocs, centr√©e -->
          <div class="profile-health-bar-wrap">
            <div class="health-bar-container">
              <div id="healthBar" class="health-bar"></div>
            </div>
          </div>

          <!-- Ligne avec Steps + Distance -->
          <!-- Bloc "steps + distance" c√¥te √† c√¥te -->
          <div class="profile-row">
            <div class="profile-item half">
              <div class="profile-label">Steps</div>
              <div id="profileStepsTotal" class="profile-value small">‚Äî</div>
            </div>

            <div class="profile-item half">
              <div class="profile-label">Distance</div>
              <div id="profileDistanceKm" class="profile-value small">‚Äî</div>
            </div>

          </section>


      </section>

            <!-- Sous-page : Nutrition -->
            <section id="tab2-nutrition" class="tab">
              <button class="back" onclick="backFromNutrition()">
                ‚Üê Retour
              </button>

              <div class="card card-nutrition">
                <div class="card-header">
                  <h2 class="nutrition-title">Programme nutrition</h2>
                  <span id="nutriMeta" class="chip">‚Äî</span>
                </div>

                <div id="nutriDays" class="nutri-days"></div>

                <div class="nutri-content-wrap" style="position:relative; min-height:140px;">
                  <div id="nutriLoader" class="chart-lottie-loader">
                    <div id="nutriAnim" class="chart-lottie-player"></div>
                  </div>
                  <div id="nutriContent"></div>
                </div>
              </div>
            </section>


            <!-- üèãÔ∏è Sous-onglet TRAINING -->
            <section id="tab2-training" class="tab hidden">

              <button class="back" onclick="backFromTraining()">
                ‚Üê Retour
              </button>

              <button class="primary full-btn" onclick="openTrainingSheet()">PROGRAMME</button>

            </section>


    <!-- Onglet 2 : menu -->
            <section id="tab2" class="tab">
              <h2 id="tab2-title" class="section-title home-anim">Mon suivi</h2>
              <div id="tab2-menu" class="dashboard-grid">
                <button class="tile"
                  onclick="switchTab('tab2-sleep', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
                  üò¥ SOMMEIL
                </button>
                <button class="tile"
                  onclick="switchTab('tab2-weight', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
                  ‚öñÔ∏è POIDS
                </button>
                <button class="tile"
                  onclick="switchTab('tab2-steps', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
                  üëüPAS
                </button>
                <button class="tile"
                  onclick="switchTab('tab2-energy', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
                  ‚ö° √âNERGIE
                </button>

                <!-- üÜï Nouveau : acc√®s Profil depuis l'onglet Suivi -->
                <button class="tile" onclick="openProfileFromSuivi()">
                  üë§ PROFIL
                </button>

                <!-- üÜï Nouveau : acc√®s To Do List depuis l'onglet Suivi -->
                <button class="tile" onclick="openTodo()">
                  ‚úÖ TO DO LIST
                </button>
              </div>
            </section>


            <!-- Sous-page : Graphique Sommeil -->
            <section id="tab2-sleep" class="tab">
              <button class="back"
                onclick="switchTab('tab2', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
                ‚Üê Retour
              </button>

              <div class="card">
                <div class="card-header">
                  <h2>Sommeil (dur√©e)</h2>
                  <span id="lastSleepBadge" class="chip">‚Äî</span>
                </div>

                <!-- üÜï Wrapper avec loader + canvas -->
                <div class="chart-wrap" style="height:260px; position:relative;">
                  <!-- Loader Lottie pour le sommeil -->
                  <div id="sleepLoader" class="chart-lottie-loader">
                    <div id="sleepAnim" class="chart-lottie-player"></div>
                  </div>

                  <!-- Canvas du graphique -->
                  <canvas id="sleepChart"></canvas>
                </div>
              </div>

              <!-- üü£ Ta carte de moyenne, on la laisse comme tu l‚Äôavais -->
              <div class="card sleep-avg-card">
                <div class="card-header">
                  <div class="summary-title">Moyenne sur les 7 derniers jours</div>
                </div>
                <div class="sleep-summary-body">
                  <div id="sleepAvgText" class="sleep-summary-value">‚Äî</div>
                </div>
              </div>
            </section>




            <!-- Sous-page : Graphique Poids -->
            <section id="tab2-weight" class="tab">
              <button class="back"
                onclick="switchTab('tab2', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
                ‚Üê Retour
              </button>

              <div class="card">
                <div class="card-header">
                  <h2>√âvolution du poids</h2>
                  <span id="lastWeightBadge" class="chip">‚Äî</span>
                </div>

                <!-- üÜï Wrapper avec loader + canvas -->
                <div class="chart-wrap" style="height:260px; position:relative;">
                  <!-- Loader Lottie pour le poids -->
                  <div id="weightLoader" class="chart-lottie-loader">
                    <div id="weightAnim" class="chart-lottie-player"></div>
                  </div>

                  <!-- Canvas du graphique -->
                  <canvas id="weightChart"></canvas>
                </div>
              </div>

            <!-- üÜï Carte Moyenne 7 jours -->
            <div id="weightAvgCard" class="summary-card weight-avg-card">
              <div class="summary-title">Moyenne sur les 7 derniers jours</div>
              <div id="weightAvgValue" class="summary-value">‚Äî</div>
            </div>

          </section>


            <!-- Sous-page : Graphique Pas -->
            <section id="tab2-steps" class="tab">
              <button class="back"
                onclick="switchTab('tab2', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
                ‚Üê Retour
              </button>

              <div class="card">
                <div class="card-header">
                  <h2>Nombre de pas</h2>
                  <span id="lastStepsBadge" class="chip">‚Äî</span>
                </div>

                <!-- üÜï Wrapper avec loader + canvas -->
                <div class="chart-wrap" style="height:260px; position:relative;">
                  <!-- Loader Lottie pour les pas -->
                  <div id="stepsLoader" class="chart-lottie-loader">
                    <div id="stepsAnim" class="chart-lottie-player"></div>
                  </div>

                  <!-- Canvas du graphique -->
                  <canvas id="stepsChart"></canvas>
                </div>
              </div>

              <!-- üÜï Carte moyenne 7 jours -->
              <div id="stepsAvgCard" class="summary-card summary-steps">
                <div class="summary-title">Moyenne sur les 7 derniers jours</div>
                <div id="stepsAvgValue" class="summary-value">‚Äî</div>
              </div>
            </section>

            <!-- Sous-page : Graphique √ânergie -->
            <section id="tab2-energy" class="tab">
              <button class="back"
                onclick="switchTab('tab2', document.querySelector('.tab-btn[data-tab=&quot;tab2&quot;]'))">
                ‚Üê Retour
              </button>

              <div class="card">
                <div class="card-header">
                  <h2>√ânergie</h2>
                  <span id="lastEnergyBadge" class="chip">‚Äî</span>
                </div>

                <!-- Wrapper avec loader + canvas -->
                <div class="chart-wrap" style="height:260px; position:relative;">
                  <!-- Loader Lottie √ânergie -->
                  <div id="energyLoader" class="chart-lottie-loader">
                    <div id="energyAnim" class="chart-lottie-player"></div>
                  </div>

                  <!-- Canvas du graphique -->
                  <canvas id="energyChart"></canvas>
                </div>
              </div>

              <!-- Carte moyenne 7 jours -->
              <div id="energyAvgCard" class="summary-card energy-avg-card">
                <div class="summary-title">Moyenne sur les 7 derniers jours</div>
                <div id="energyAvgValue" class="summary-value">‚Äî</div>
              </div>
            </section>






    <!-- Onglet 3 -->
    <section id="tab3" class="tab">
      <p class="note">Ping ton Apps Script puis regarde la r√©ponse ci-dessous.</p>
      <button id="ping" class="primary" onclick="pingScript()">Tester la connexion</button>
      <pre id="pingResult"></pre>
    </section>

    <div id="appVersion" class="app-version">Version : 0.1.3 (07/12/2025)</div>

            <!-- Onglet TO DO LIST -->
            <section id="tab2-todo" class="tab">

              <!-- Bouton Retour -->
              <button class="back"
                onclick="returnFromTodo()">
                ‚Üê Retour
              </button>


              <!-- Bouton Ajouter une t√¢che -->
              <button class="primary" onclick="addTodo()" style="margin-bottom: 14px;">
                + Ajouter une t√¢che
              </button>

              <!-- Carte principale -->
              <div class="card">
                <div class="card-header">
                  <h2>To Do List</h2>
                </div>

                <!-- Contenu des t√¢ches + anim au centre -->
                <div id="todoContent" class="todo-wrap">
                  <div id="todoAnimation" class="todo-lottie"></div>
                </div>
              </div>


            </section>

            <p id="debugClient" style="font-size:12px; color:#888; margin-top:8px;"></p>

  </main>

            <audio id="clickSound" src="./sounds/click.mp3" preload="auto"></audio>
            <audio id="clickTabSound" src="./sounds/click-tab.mp3" preload="auto"></audio>

  <!-- Barre de navigation -->
  <nav class="bottom-nav">
    <button type="button" class="tab-btn active" data-tab="tab1" onclick="switchTab('tab1', this)">Accueil</button>
    <button type="button" class="tab-btn" data-tab="tab2" onclick="switchTab('tab2', this)">Suivi</button>
    <button type="button" class="tab-btn" data-tab="tab3" onclick="switchTab('tab3', this)">Param√®tres</button>
  </nav>


  <script>
  if ('serviceWorker' in navigator) {
    // ‚ö†Ô∏è Mettez √† jour ce num√©ro √† chaque release
    const SW_VERSION = 'v15';
    navigator.serviceWorker.register(`./sw.js?${SW_VERSION}`).then(reg => {
      setInterval(() => reg.update(), 60 * 60 * 1000);
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        location.reload();
      });
    });
  }
  </script>

            <!-- Lottie Web (un seul, comme sur Scratch Mouse) -->
            <script src="https://unpkg.com/lottie-web@latest/build/player/lottie.min.js"></script>
            <!-- Ton script principal -->
            <script src="./script.js?v=12"></script>


</body>
</html>
